---
- name: Download CW Agent
  shell: wget https://s3.amazonaws.com/amazoncloudwatch-agent/debian/amd64/latest/amazon-cloudwatch-agent.deb
  args:
    chdir: "/"
  notify:
    - Install CW Agent

- name: Generate New CW Configs
  template:
    src: config.json
    dest: /opt/aws/amazon-cloudwatch-agent/bin/config.json
    owner: root
    group: root
  vars:
    cloutInitOutputLog: "{{ cloud_init_output_log }}"
    nginxErrorLog: "{{ nginx_error_log }}"
    nginxAccessLog: "{{ nginx_access_log }}"
  notify:
    - Fetch the config and start the agent